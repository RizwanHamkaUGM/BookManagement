<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const baseURL = "http://localhost:8000/api/books";

    // Fetch and display books
    async function fetchBooks() {
      const response = await fetch(baseURL);
      const data = await response.json();
      const bookTable = document.getElementById("book-table-body");
      bookTable.innerHTML = "";
      data.data.forEach((book) => {
        bookTable.innerHTML += `
          <tr>
            <td>${book.id}</td>
            <td>${book.title}</td>
            <td>${book.author}</td>
            <td>${book.published_at}</td>
            <td>
              <button class="btn btn-warning btn-sm" onclick="openUpdateModal(this)" data-id="${book.id}">Edit</button>
              <button class="btn btn-danger btn-sm" onclick="deleteBook(${book.id})">Delete</button>
            </td>
          </tr>`;
      });
    }

    // Add a book
    async function addBook() {
      const newBook = {
        title: document.getElementById("add-title").value.trim(),
        author: document.getElementById("add-author").value.trim(),
        published_at: document.getElementById("add-published-at").value.trim()
      };

      const response = await fetch(baseURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newBook)
      });

      if (response.ok) {
        alert("Book added successfully");
        fetchBooks();
      } else {
        alert("Failed to add book");
      }
    }

    // Update a book
    async function updateBook(id) {
      const updatedBook = {
        title: document.getElementById("update-title").value.trim(),
        author: document.getElementById("update-author").value.trim(),
        published_at: document.getElementById("update-published-at").value.trim()
      };

      const response = await fetch(`${baseURL}/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedBook)
      });

      if (response.ok) {
        alert("Book updated successfully");
        fetchBooks();
      } else {
        alert("Failed to update book");
      }
    }

    // Delete a book
    async function deleteBook(id) {
      if (confirm("Are you sure you want to delete this book?")) {
        const response = await fetch(`${baseURL}/${id}`, {
          method: "DELETE"
        });

        if (response.ok) {
          alert("Book deleted successfully");
          fetchBooks();
        } else {
          alert("Failed to delete book");
        }
      }
    }

    // Open update modal
    function openUpdateModal(button) {
      const id = button.getAttribute("data-id");
      const row = button.closest("tr");

      document.getElementById("update-title").value = row.children[1].textContent;
      document.getElementById("update-author").value = row.children[2].textContent;
      document.getElementById("update-published-at").value = row.children[3].textContent;
      document.getElementById("update-book-id").value = id;

      new bootstrap.Modal(document.getElementById("updateModal")).show();
    }

    // Submit update
    function submitUpdate() {
      const id = document.getElementById("update-book-id").value;
      updateBook(id);
    }
  </script>
</head>
<body onload="fetchBooks()">
  <div class="container mt-5">
    <h1 class="text-center mb-4">Book Management</h1>

    <!-- Add Book Form -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>Add New Book</h5>
        <form onsubmit="addBook(); return false;">
          <div class="row">
            <div class="col-md-4">
              <input id="add-title" type="text" class="form-control" placeholder="Title" required>
            </div>
            <div class="col-md-4">
              <input id="add-author" type="text" class="form-control" placeholder="Author" required>
            </div>
            <div class="col-md-4">
              <input id="add-published-at" type="date" class="form-control" required>
            </div>
          </div>
          <button type="submit" class="btn btn-primary mt-3">Add Book</button>
        </form>
      </div>
    </div>

    <!-- Book Table -->
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Author</th>
          <th>Published Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="book-table-body"></tbody>
    </table>

    <!-- Update Modal -->
    <div class="modal fade" id="updateModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Update Book</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form>
              <input id="update-book-id" type="hidden">
              <div class="mb-3">
                <label for="update-title" class="form-label">Title</label>
                <input id="update-title" type="text" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="update-author" class="form-label">Author</label>
                <input id="update-author" type="text" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="update-published-at" class="form-label">Published Date</label>
                <input id="update-published-at" type="date" class="form-control" required>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="submitUpdate()">Update Book</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
